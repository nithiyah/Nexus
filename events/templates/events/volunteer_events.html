{% extends 'base.html' %}
{% block title %}My Registered Events{% endblock %}

{% block content %}
<div class="container mt-4">
  <h1 class="text-center mb-4">My Registered Events</h1>

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h2>My Events</h2>
    <a href="{% url 'accounts:volunteer_event_report' %}" class="btn btn-report">
      <i class="bi bi-card-list"></i> View My Event Report
    </a>
  </div>

  {% if registered_events %}
    <div class="row g-4">
      {% for registration in registered_events %}
        <div class="col-md-6 col-lg-4">
          <div class="card shadow-sm mb-4 h-100">
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-dark">{{ registration.event.name }}</h5>
              <p><strong>Organised by:</strong> {{ registration.event.organisation.username }}</p>
              <p><strong>Date:</strong> {{ registration.event.date|date:"M d, Y" }}</p>
              <p><strong>Time:</strong> {{ registration.event.start_time|time:"H:i" }} - {{ registration.event.end_time|time:"H:i" }}</p>
              <p><strong>Location:</strong> {{ registration.event.location }}</p>
              <p><strong>Category:</strong> {{ registration.event.category }}</p>
              <p class="text-muted flex-grow-1">{{ registration.event.description }}</p>

              <div class="d-grid gap-2 mt-auto">
                <a href="{% url 'chat:chat_room' registration.event.id %}" class="btn btn-chat w-100">
                  <i class="bi bi-chat-right"></i> Join Chat Room
                </a>

                {% if registration.event.date.date >= today %}
                    <form action="{% url 'events:cancel_registration' registration.event.id %}" method="post">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-cancel w-100">
                        <i class="bi bi-x-square"></i> Cancel Registration
                        </button>
                    </form>
                    {% else %}
                    <button class="btn btn-secondary w-100" disabled>
                        <i class="bi bi-check2-square"></i> Event Completed
                    </button>
                    {% endif %}


                {% if registration.event.feedback_form %}
                  {% if registration.event.feedback_form.published %}
                    {% if registration.has_submitted_feedback %}
                      <button class="btn btn-secondary w-100" disabled>
                        <i class="bi bi-file-text"></i> Feedback Submitted
                      </button>
                    {% else %}
                      <a href="{% url 'events:complete_feedback' registration.event.id %}" class="btn btn-feedback w-100">
                        <i class="bi bi-file-text"></i> Complete Feedback Form
                      </a>
                    {% endif %}
                  {% else %}
                    <p class="text-danger"><strong>The feedback form has not been published yet.</strong></p>
                  {% endif %}
                {% else %}
                  <p class="text-muted">No feedback form available for this event.</p>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-info text-center">
      <p>You haven't registered for any events yet.</p>
    </div>
  {% endif %}
</div>

<!-- Styling -->
<style>
  .btn {
    border-radius: 15px;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
  }

  .btn-report {
    background-color: #2b9faa;
    color: white;
    border: 2px solid #2b9faa;
  }

  .btn-report:hover {
    background-color: #1B6165;
    border-color: #1B6165;
    color: white;
  }

  .btn-chat {
    background-color: #5e60ce;
    color: white;
    border: 2px solid #5e60ce;
  }

  .btn-chat:hover {
    background-color: #4a4db4;
    border-color: #4a4db4;
    color: white;
  }

  .btn-feedback {
    background-color: #e76f51;
    color: white;
    border: 2px solid #e76f51;
  }

  .btn-feedback:hover {
    background-color: #c85b3b;
    border-color: #c85b3b;
    color: white;
  }

  .btn-cancel {
    background-color: #dc3545;
    color: white;
    border: 2px solid #dc3545;
  }

  .btn-cancel:hover {
    background-color: #bb2d3b;
    border-color: #bb2d3b;
    color: white;
  }

  .card-title {
    font-weight: 600;
  }

  .btn i {
    margin-right: 6px;
  }
</style>
{% endblock %}
