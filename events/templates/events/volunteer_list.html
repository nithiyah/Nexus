{% extends "base.html" %}

{% block title %}Volunteer List{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1 class="mb-0">Volunteer List for {{ event.name }}</h1>
        <a href="{% url 'events:organisation_events' %}" class="btn btn-secondary">Back to My Events</a>
    </div>
    
    <p><strong>Date:</strong> {{ event.date|date:"M d, Y H:i" }}</p>
    <p><strong>Location:</strong> {{ event.location }}</p>
    <p><strong>Category:</strong> {{ event.get_category_display }}</p>
    <p>{{ event.description }}</p>

    {% if volunteers %}
        <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
            <table class="table table-bordered border-dark">
                <thead class="bg-primary text-white">
                    <tr>
                        <th class="border-dark">Full Name</th>
                        <th class="border-dark">Email</th>
                        <th class="border-dark">Mobile Number</th>
                        <th class="border-dark">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for registration in volunteers %}
                        <tr>
                            <td class="border-dark">{{ registration.volunteer.full_name }}</td>
                            <td class="border-dark">{{ registration.volunteer.email }}</td>
                            <td class="border-dark">{{ registration.volunteer.contact_number }}</td>
                            <td class="border-dark">
                                <!-- Button to Open Modal -->
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#confirmRemoveModal" onclick="setVolunteerToRemove('{{ registration.id }}', '{{ registration.volunteer.full_name }}')">
                                    Remove
                                </button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <p class="text-muted">No volunteers have signed up yet.</p>
    {% endif %}
</div>

<!-- Bootstrap Remove Confirmation Modal -->
<div class="modal fade" id="confirmRemoveModal" tabindex="-1" aria-labelledby="confirmRemoveModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title text-danger" id="confirmRemoveModalLabel">Confirm Removal</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to remove <strong id="volunteerName"></strong> from this event?
            </div>
            <div class="modal-footer">
                <form id="removeVolunteerForm" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-danger">Yes, Remove</button>
                </form>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    function setVolunteerToRemove(volunteerId, volunteerName) {
        document.getElementById("volunteerName").textContent = volunteerName;
        document.getElementById("removeVolunteerForm").action = `/events/remove-volunteer/${volunteerId}/`;
    }
</script>

{% endblock %}
