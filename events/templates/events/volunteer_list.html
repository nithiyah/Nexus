{% extends "base.html" %}
{% block title %}Volunteer List{% endblock %}

{% block content %}
<div class="container mt-4">
  <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 print-hidden">
    <h1 class="mb-3 mb-md-0">Volunteer List for {{ event.name }}</h1>
    <div class="d-flex gap-2">
      <button onclick="window.print()" class="btn btn-print">
        <i class="bi bi-printer"></i> Print
      </button>
      <a href="{% url 'events:organisation_dashboard' %}" class="btn btn-back">
        <i class="bi bi-arrow-left"></i> Back to Dashboard
      </a>
    </div>
  </div>

  <div class="mb-4">
    <p><strong>Date:</strong> {{ event.date|date:"M d, Y H:i" }}</p>
    <p><strong>Location:</strong> {{ event.location }}</p>
    <p><strong>Category:</strong> {{ event.get_category_display }}</p>
    <p>{{ event.description }}</p>
  </div>

  {% if volunteers %}
    <div class="table-responsive" style="max-height: 400px; overflow-y: auto;">
      <table class="table table-bordered border-dark">
        <thead style="background-color: #2b9faa;" class="text-white">
          <tr>
            <th class="border-dark">Volunteer</th>
            <th class="border-dark">Full Name</th>
            <th class="border-dark">Email</th>
            <th class="border-dark">Mobile Number</th>
            <th class="border-dark print-hidden">Action</th>
          </tr>
        </thead>
        <tbody>
          {% for registration in volunteers %}
            <tr>
              <td class="border-dark d-flex align-items-center">
                {% if registration.volunteer.profile_picture %}
                  <img src="{{ registration.volunteer.profile_picture.url }}" alt="Profile Picture" class="rounded-circle me-2" width="40" height="40">
                {% else %}
                  <img src="https://via.placeholder.com/40" alt="Default Profile" class="rounded-circle me-2">
                {% endif %}
                <a href="{% url 'accounts:public_profile' registration.volunteer.username %}" class="text-decoration-none text-primary">
                  {{ registration.volunteer.username }}
                </a>
              </td>
              <td class="border-dark">{{ registration.volunteer.full_name }}</td>
              <td class="border-dark">{{ registration.volunteer.email }}</td>
              <td class="border-dark">{{ registration.volunteer.contact_number }}</td>
              <td class="border-dark print-hidden">
                <button type="button" class="btn btn-remove w-100" data-bs-toggle="modal" data-bs-target="#confirmRemoveModal" onclick="setVolunteerToRemove('{{ registration.id }}', '{{ registration.volunteer.full_name }}')">
                  <i class="bi bi-x-circle"></i> Remove
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <p class="text-muted">No volunteers have signed up yet.</p>
  {% endif %}
</div>

<!-- Modal -->
<div class="modal fade" id="confirmRemoveModal" tabindex="-1" aria-labelledby="confirmRemoveModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content rounded-3">
      <div class="modal-header">
        <h5 class="modal-title text-danger" id="confirmRemoveModalLabel">Confirm Removal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to remove <strong id="volunteerName"></strong> from this event?
      </div>
      <div class="modal-footer">
        <form id="removeVolunteerForm" method="post">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger px-4">
            <i class="bi bi-check2-circle"></i> Yes, Remove
          </button>
        </form>
        <button type="button" class="btn btn-cancel px-4" data-bs-dismiss="modal">
          <i class="bi bi-x"></i> Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<script>
  function setVolunteerToRemove(volunteerId, volunteerName) {
    document.getElementById("volunteerName").textContent = volunteerName;
    document.getElementById("removeVolunteerForm").action = `/events/remove-volunteer/${volunteerId}/`;
  }
</script>

<!-- Styles -->
<style>
  .btn {
    border-radius: 15px;
    font-weight: 500;
    transition: all 0.2s ease-in-out;
  }

  .btn-print {
    background-color: #2b9faa;
    color: white;
    border: 2px solid #2b9faa;
  }

  .btn-print:hover {
    background-color: #1B6165;
    border-color: #1B6165;
    color: white;
  }

  .btn-back {
    background-color: #f1f1f1;
    color: #333;
    border: 2px solid #ccc;
  }

  .btn-back:hover {
    background-color: #e0e0e0;
    color: #000;
    border-color: #bbb;
  }

  .btn-cancel {
    background-color: #f8f9fa;
    color: #333;
    border: 2px solid #ccc;
  }

  .btn-cancel:hover {
    background-color: #eaeaea;
    color: #111;
  }

  .btn-remove {
    background-color: #e63946;
    color: white;
    border: 2px solid #e63946;
  }

  .btn-remove:hover {
    background-color: #c92a36;
    border-color: #c92a36;
    color: white;
  }

  .table th, .table td {
    vertical-align: middle;
    word-break: break-word;
    white-space: normal;
    font-size: 15px;
  }

  @media print {
    body {
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }

    @page {
      size: A4 landscape;
      margin: 20mm;
    }

    .navbar, .btn, .modal, .modal-backdrop, .print-hidden {
      display: none !important;
    }

    .table-responsive {
      overflow: visible !important;
      max-height: none !important;
    }

    .container {
      padding: 0;
      margin: 0;
      width: 100%;
    }

    h1 {
      font-size: 20px;
    }

    table {
      font-size: 12px;
      width: 100%;
    }

    td, th {
      padding: 6px;
    }
  }
</style>
{% endblock %}
