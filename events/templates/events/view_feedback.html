{% extends 'base.html' %}

{% block title %}Feedback for {{ event.name }}{% endblock %}

{% block content %}
    <h1>Feedback for {{ event.name }}</h1>

    {% if feedback_entries %}
        <div style="display: flex; flex-wrap: wrap; gap: 15px;">
            {% for feedback in feedback_entries %}
                <div style="border: 1px solid #ddd; padding: 15px; width: 350px; border-radius: 8px;">
                    <h3>{{ feedback.volunteer.full_name }}</h3>
                    <p><strong>Overall Event Experience:</strong> {{ feedback.rating_1 }}</p>
                    <p><strong>Registration Process:</strong> {{ feedback.rating_2 }}</p>
                    <p><strong>Event Location/Venue:</strong> {{ feedback.rating_3 }}</p>
                    <p><strong>Event Schedule and Timing:</strong> {{ feedback.rating_4 }}</p>
                    <p><strong>Communication:</strong> {{ feedback.rating_5 }}</p>

                    {% if feedback.additional_answer_1 %}
                        <p><strong>What did you like most?</strong> {{ feedback.additional_answer_1 }}</p>
                    {% endif %}
                    
                    {% if feedback.additional_answer_2 %}
                        <p><strong>What did you like least?</strong> {{ feedback.additional_answer_2 }}</p>
                    {% endif %}

                    <p><strong>Notify about future events?</strong> 
                        {{ feedback.notify_future_events|yesno:"Yes,No" }}
                    </p>
                    <p><strong>Follow-up contact allowed?</strong> 
                        {{ feedback.allow_follow_up_contact|yesno:"Yes,No" }}
                    </p>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No feedback has been submitted yet.</p>
    {% endif %}

    <h2>Feedback Summary</h2>
<canvas id="feedbackChart" width="400" height="200"></canvas>

    <!-- Load Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Get the average ratings from Django context
        var averageRatings = JSON.parse('{{ average_ratings|escapejs }}');

        var ctx = document.getElementById('feedbackChart').getContext('2d');
        var feedbackChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Overall Experience', 'Registration', 'Venue', 'Schedule', 'Communication'],
                datasets: [{
                    label: 'Average Ratings',
                    data: averageRatings,
                    backgroundColor: ['blue', 'green', 'purple', 'orange', 'red']
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true, max: 5 }
                }
            }
        });
    </script>

{% endblock %}
